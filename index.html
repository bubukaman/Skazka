<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫–∞–∑–∫–∏</title>
  <style>
    body {
      background: #0d1b2a;
      color: #e0e1dd;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #00b4d8;
    }
    .button {
      background: #00b4d8;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    .button:hover {
      background: #0077b6;
      color: #fff;
    }
    textarea {
      background: #1b263b;
      color: #e0e1dd;
      border: 1px solid #415a77;
      border-radius: 5px;
      padding: 5px;
      width: 100%;
      resize: vertical;
    }
    input[type="text"], input[type="color"], input[type="number"] {
      background: #1b263b;
      color: #e0e1dd;
      border: 1px solid #415a77;
      border-radius: 5px;
      padding: 5px;
    }
    #codeContainer {
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∫–∞–∑–∫–∏ üìù</h1>

  <div id="storyBuilder">
    <button class="button" onclick="addText()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
    <button class="button" onclick="addNumber()">–î–æ–±–∞–≤–∏—Ç—å —á–∏—Å–ª–æ</button>
    <div id="storyParts"></div>
    <button class="button" onclick="nextStep()">–î–∞–ª—å—à–µ</button>
  </div>

  <div id="questionBuilder" style="display:none;">
    <h2>–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —á–∏—Å–µ–ª</h2>
    <div id="questions"></div>
    <button class="button" onclick="backToStory()">–ù–∞–∑–∞–¥</button>
    <button class="button" onclick="showSettings()">–î–∞–ª—å—à–µ</button>
  </div>

  <div id="settings" style="display:none;">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <label><input type="checkbox" id="randomOrder" /> –í–æ–ø—Ä–æ—Å—ã –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</label><br/>
    <label>–§–æ–Ω (hex): <input type="color" id="bgColor" value="#000000"></label><br/>
    <label>–¶–≤–µ—Ç –ª–∏—Å—Ç–∞ (hex): <input type="color" id="paperColor" value="#ffffff"></label><br/>
    <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ (hex): <input type="color" id="textColor" value="#000000"></label><br/>
    <label>–í–∞—à –Ω–∏–∫: <input type="text" id="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫"></label><br/>
    <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): <input type="text" id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–∞–∑–∫–∏"></label><br/>
    <button class="button" onclick="generateCode()">–ì–æ—Ç–æ–≤–æ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
  </div>

  <div id="codeContainer">
    <textarea id="finalCode" rows="5" readonly></textarea>
    <button class="button" onclick="copyCode()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
  </div>

  <script>
    let storyParts = [];
    let questions = [];

    function addText() {
      const text = prompt("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç");
      if (text) {
        storyParts.push({type: 'text', value: text});
        updateStoryParts();
      }
    }

    function addNumber() {
      const number = prompt("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤");
      if (number && !number.includes(' ')) {
        storyParts.push({type: 'number', value: number});
        updateStoryParts();
      } else {
        alert("–ß–∏—Å–ª–æ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª–æ–≤!");
      }
    }

    function updateStoryParts() {
      const container = document.getElementById("storyParts");
      container.innerHTML = '';
      storyParts.forEach((part, index) => {
        const el = document.createElement("div");
        el.innerHTML = part.type === 'text' ? 
          `<span style="color:#00b4d8;">[–¢–µ–∫—Å—Ç]</span> ${part.value}` :
          `<span style="color:red;">[–ß–∏—Å–ª–æ]</span> ${part.value}`;
        el.style.cursor = 'pointer';
        el.onclick = () => editPart(index);
        container.appendChild(el);
      });
    }

    function editPart(index) {
      const part = storyParts[index];
      const newValue = prompt("–ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ", part.value);
      if (newValue) {
        if (part.type === 'number' && newValue.includes(' ')) {
          alert("–ß–∏—Å–ª–æ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª–æ–≤!");
          return;
        }
        part.value = newValue;
        updateStoryParts();
      }
    }

    function nextStep() {
      questions = [];
      const container = document.getElementById("questions");
      container.innerHTML = '';
      storyParts.filter(p => p.type === 'number').forEach((p) => {
        const div = document.createElement("div");
        div.innerHTML = `<label>–í–æ–ø—Ä–æ—Å –¥–ª—è —á–∏—Å–ª–∞ <b>${p.value}</b>: <input type="text" /></label>`;
        container.appendChild(div);
        questions.push({num: p.value, question: ''});
      });
      document.getElementById("storyBuilder").style.display = "none";
      document.getElementById("questionBuilder").style.display = "block";
    }

    function backToStory() {
      document.getElementById("questionBuilder").style.display = "none";
      document.getElementById("storyBuilder").style.display = "block";
    }

    function showSettings() {
      const inputs = document.querySelectorAll("#questions input");
      inputs.forEach((input, i) => {
        questions[i].question = input.value || `–í–æ–ø—Ä–æ—Å –¥–ª—è ${questions[i].num}`;
      });
      document.getElementById("questionBuilder").style.display = "none";
      document.getElementById("settings").style.display = "block";
    }

    function generateCode() {
      const data = {
        storyParts,
        questions,
        settings: {
          randomOrder: document.getElementById("randomOrder").checked,
          bgColor: document.getElementById("bgColor").value,
          paperColor: document.getElementById("paperColor").value,
          textColor: document.getElementById("textColor").value,
          nickname: document.getElementById("nickname").value,
          description: document.getElementById("description").value
        }
      };
      const jsonString = JSON.stringify(data);
      const code = btoa(unescape(encodeURIComponent(jsonString)));
      document.getElementById("finalCode").value = code;
      document.getElementById("codeContainer").style.display = "block";
    }

    function copyCode() {
      const textarea = document.getElementById("finalCode");
      textarea.select();
      document.execCommand("copy");
      alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
    }
  </script>
</body>
</html>
